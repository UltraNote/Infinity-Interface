<div class="container input-bg-purple-dark">
  <div class="slim-pageheader">
    <ol class="breadcrumb slim-breadcrumb">
      <li class="breadcrumb-item">
        <a href="#">Home</a>
      </li>
      <li class="breadcrumb-item active" aria-current="page">
        <span tkey="dashboard">Dashboard</span>
      </li>
    </ol>
    <h6 class="slim-pagetitle">
      <span tkey="dashboard">Dashboard</span>
    </h6>
  </div>
  <!-- slim-pageheader -->

  <div class="dash-headline">
    <div class="dash-headline-left">
      <div class="dash-headline-item-one">
        <div id="chartPoolHashrate" class="dash-chartist">
          <canvas id="chartPoolHashrateCanvas"></canvas>
          <a class="chart-style"></a>
        </div>
        <div class="dash-item-overlay">
          <h1>
            <span class="mediumText" id="poolHashrate">N/A</span>
            <span class="smallText">(<span id="hashPower">0%</span>)
          </h1>
          <p class="earning-label" tkey="poolHashrate">Pool Hashrate</p>
          <a data-page="worker_stats.html" href="#worker_stats" class="statement-link" id="btnWorkerStats">Worker
            Stats<i class="fa fa-angle-right mg-l-5"></i>
          </a>
        </div>
      </div>
      <!-- dash-headline-item-one -->

    </div>
    <!-- dash-headline-left -->

    <div class="dash-headline-right">
      <div class="dash-headline-right-top">
        <div class="dash-headline-item-two">
          <div id="chartCurrDiff" class="dash-chartist">
            <canvas id="chartCurrDiffCanvas"></canvas>
            <a class="chart-style"></a>
          </div>
          <div class="dash-item-overlay">
            <h4>
              <span id="networkDifficulty">N/A</span>
            </h4>
            <p class="item-label">Current Difficulty</p>
          </div>
        </div>
        <!-- dash-headline-item-two -->
      </div>
      <!-- dash-headline-right-top -->
      <div class="dash-headline-right-bottom">
        <div class="dash-headline-right-bottom-left">
          <div class="dash-headline-item-three">
            
            <div>
              <h2 style="color: white;">
                <span id="poolMiners">N/A</span>
                <span>(<strong>
                    <span id="poolWorkers">N/A</span></strong>
                  <span tkey="workersCount">workers</span>)</span>
              </h2>
              <p class="item-label">Miners / Workers</p>
            </div>
            <canvas id="chartMiners"></canvas>
          </div>
          
        </div>
        <!-- dash-headline-right-bottom-left -->
        <div class="dash-headline-right-bottom-right">
          <div class="dash-headline-item-three">
            <span id="chartBlocksFound" class="sparkline wd-100p"></span>
            <div>
              <h2 style="color: white;">
                <span id="blocksTotal">N/A</span>
                <br>
                (<span id="poolLastBlockFound">Never</span>)
              </h2>
              <p class="item-label">Blocks found</p>
            </div>
          </div>
          <!-- dash-headline-item-three -->
        </div>
        <!-- dash-headline-right-bottom-right -->
      </div>
      <!-- dash-headline-right-bottom -->
    </div>
    <!-- wd-50p -->
  </div>
  <!-- d-flex ht-100v -->

  <div class="row justify-content-center mt-5 pt-5 mb-5">
    <div class="col-xl-3 col-sm-6 m-t35 margin-top4em">
      <div class="card height-10em border-radius20px">
        <div class="card-body text-center">
          <img src="../img/dollars.png" class="margin-top-65px height-icon-width" alt="not found"/>
          <h4 class="text-white font-weight-600">Network Hashrate</h4>
          <br/>
          <h6 class="text-white" id="networkHashrate">N/A</h6>
        </div>

      </div>

    </div>
    <div class="col-xl-3 col-sm-6 m-t35 margin-top4em">
      <div class="card height-10em border-radius20px">
        <div class="card-body text-center">
          <img src="../img/dollars.png" class="margin-top-65px height-icon-width" alt="not found"/>
          <h4 class="text-white font-weight-600">Block Found Every</h4>
          <br/>
          <h6 class="text-white" id="blockSolvedTime">N/A</h6>
        </div>

      </div>

    </div>
    <div class="col-xl-3 col-sm-6 m-t35 margin-top4em">
      <div class="card height-10em border-radius20px">
        <div class="card-body text-center">
          <img src="../img/market-cap.png" class="margin-top-65px height-icon-width" alt="not found"/>
          <h4 class="text-white font-weight-600">Last Reward</h4>
          <br/>
          <h6 class="text-white" id="networkLastReward">N/A</h6>
        </div>

      </div>

    </div>
    <div class="col-xl-3 col-sm-6 m-t35 margin-top4em">
      <div class="card height-10em border-radius20px">
        <div class="card-body text-center">
          <img src="../img/volume.png" class="margin-top-65px height-icon-width" alt="not found"/>
          <h4 class="text-white font-weight-600">Current Effort</h4>
          <br/>
          <h6 class="text-white" id="currentEffort">Daily Volume</h6>
        </div>

      </div>

    </div>
  </div>
  <!-- card -->

  <div class="row justify-content-center mt-5 pt-5 mb-5">
    <div class="col-xl-3 col-sm-6 m-t35 margin-top4em">
      <div class="card height-10em border-radius20px">
        <div class="card-body text-center">
          <img src="../img/dollars.png" class="margin-top-65px height-icon-width" alt="not found"/>
          <h4 class="text-white font-weight-600">Pool Fee</h4>
          <br/>
          <h6 class="text-white" id="poolFee">N/A</h6>
        </div>

      </div>

    </div>
    <div class="col-xl-3 col-sm-6 m-t35 margin-top4em">
      <div class="card height-10em border-radius20px">
        <div class="card-body text-center">
          <img src="../img/dollars.png" class="margin-top-65px height-icon-width" alt="not found"/>
          <h4 class="text-white font-weight-600">Minimum Payout</h4>
          <br/>
          <h6 class="text-white" id="paymentsMinimum">N/A</h6>
        </div>

      </div>

    </div>
    <div class="col-xl-3 col-sm-6 m-t35 margin-top4em">
      <div class="card height-10em border-radius20px">
        <div class="card-body text-center">
          <img src="../img/market-cap.png" class="margin-top-65px height-icon-width" alt="not found"/>
          <h4 class="text-white font-weight-600">Payment Interval</h4>
          <br/>
          <h6 class="text-white" id="paymentsInterval">N/A</h6>
        </div>

      </div>

    </div>
    <div class="col-xl-3 col-sm-6 m-t35 margin-top4em">
      <div class="card height-10em border-radius20px">
        <div class="card-body text-center">
          <img src="../img/volume.png" class="margin-top-65px height-icon-width" alt="not found"/>
          <h4 class="text-white font-weight-600">Blockchain Height</h4>
          <br/>
          <h6 class="text-white" id="blockchainHeight">N/A</h6>
        </div>

      </div>

    </div>
  </div>
  <!-- card -->

  <div class="slim-pageheader">
    <ol class="breadcrumb slim-breadcrumb">
      <li class="breadcrumb-item">
        <a href="#">Home</a>
      </li>
      <li class="breadcrumb-item active" aria-current="page">
        <span tkey="market">Market / Calculator</span>
      </li>
    </ol>
    <h6 class="slim-pagetitle">
      <span tkey="market">Market / Calculator</span>
    </h6>
  </div>
  <!-- slim-pageheader -->

  <!-- Statistics -->
  <div class="row justify-content-center pt-5 mb-5">
    <div class="col-xl-3 col-sm-6 m-t35 margin-top4em">
      <div class="card height-10em border-radius20px">
        <div class="card-body text-center">
          <img src="../img/dollars.png" class="margin-top-65px height-icon-width" alt="not found"/>
          <h2 id="XUNIToUSD" class="text-white font-weight-600">$168,331.09</h2>
          <br/>
          <h6 class="text-white">XUNI TO USD</h6>
        </div>

      </div>

    </div>
    <div class="col-xl-3 col-sm-6 m-t35 margin-top4em">
      <div class="card height-10em border-radius20px">
        <div class="card-body text-center">
          <img src="../img/xuni.png" class="margin-top-65px height-icon-width" alt="not found"/>
          <h2 id="XUNIToBTC" class="text-white font-weight-600">$168,331.09</h2>
          <br/>
          <h6 class="text-white">XUNI TO BTC</h6>
        </div>

      </div>

    </div>
    <div class="col-xl-3 col-sm-6 m-t35 margin-top4em">
      <div class="card height-10em border-radius20px">
        <div class="card-body text-center">
          <img src="../img/market-cap.png" class="margin-top-65px height-icon-width" alt="not found"/>
          <h2 class="text-white font-weight-600">N/A</h2>
          <br/>
          <h6 class="text-white">Market Cap</h6>
        </div>

      </div>

    </div>
    <div class="col-xl-3 col-sm-6 m-t35 margin-top4em">
      <div class="card height-10em border-radius20px">
        <div class="card-body text-center">
          <img src="../img/volume.png" class="margin-top-65px height-icon-width" alt="not found"/>
          <h2 class="text-white font-weight-600">N/A</h2>
          <br/>
          <h6 class="text-white">Daily Volume</h6>
        </div>

      </div>

    </div>
  </div>

  <div id="marketStats" class="row">
    <div id="marketInfos" class="clearfix">
      <div class="col-xs-12">
        <span class="fa fa-spinner fa-spin"></span>
        <span tkey="loadingMarket">Loading market prices</span>
        ...
      </div>
    </div>

    <div class="col-sm-6 marketChart push-down-15">
      <div class="card">
        <h4>
          <span tkey="priceIn">Price in</span>
          <span id="priceChartCurrency">USD</span>
        </h4>
        <div class="chart">
          <canvas id="chart_price"></canvas>
          <a class="chart-style"></a>
        </div>
      </div>
    </div>
    <div class="col-sm-6 marketChart push-down-15">
      <div class="card">
        <h4>
          <span tkey="hashPer">Hash/</span><span id="profitChartCurrency">USD</span>
          <span data-toggle="tooltip" data-placement="top" data-original-title="Reward * Rate / Difficulty">
            <i class="fa fa-question-circle"></i></span>
        </h4>
        <div class="chart">
          <canvas id="chart_profit"></canvas>
          <a class="chart-style"></a>
        </div>
      </div>
    </div>
  </div>

  <!-- <div id="chartMarketPrice">
    <canvas id="chartMarketPriceCanvas"></canvas>
    <a class="chart-style"></a>
  </div> -->

  <!-- Mining Profit Calculator -->
  <div class="container">
    <div class="container card mg-t-20" id="miningProfitCalc">
      <div class="card-header tx-medium bd-0 tx-white bg-purple-dark text-center"><span tkey="estimateProfit">Estimate Mining
          Profits</span></div>
      <div class="card-body text-center m-auto" id="calcHashHolder">
        <div class="input-group">
          <input class="form-control input-bg-purple-dark" id="calcHashRate" tplaceholder="enterYourHashrate"
            placeholder="Enter Your Hash Rate" type="number">
          <div class="input-group-btn">
            <button type="button" class="btn dropdown-toggle input-bg-purple-dark" data-toggle="dropdown" id="calcHashDropdown">
              <span id="calcHashUnit" class="text-white" data-mul="1">KH/s</span> <span class="caret"></span>
            </button>
            <ul class="dropdown-menu dropdown-menu-right" role="menu" id="calcHashUnits">
              <li><a href="#" data-mul="0">H/s</a></li>
              <li><a href="#" data-mul="1">KH/s</a></li>
              <li><a href="#" data-mul="2">MH/s</a></li>
            </ul>
          </div>
          <span class="input-group-addon input-bg-purple-dark">=</span>
          <span class="input-group-addon input-bg-purple-dark" id="calcHashResultsHolder">
            <div id="calcHashAmount">
              <span id="calcHashAmount1"></span>
              <span id="calcHashSymbol"> XUNI</span>
              <span id="calcHashAmount2"></span>
            </div>
            <div id="calcHashPeriod" class="input-bg-purple-dark">
              <span tkey="perDay">per day</span>
            </div>
          </span>
        </div>
      </div>
    </div>
  </div>
    <div id="chartMarketPrice">

  </div>

</div>

</div>
<!-- container -->

<!-- Javascript -->
<script>
  // Charts initialized
  var chartsInitialized = false;
  var intervalChartsUpdate;
  var poolHashrateChart = null;
  var marketPriceChart = null;
  var diffChart = null;

  $('.toggle').toggles({ on: true, width: 65, height: 30 });


  // Update current page
  currentPage = {
    destroy: function () {
      $('#networkLastBlockFound,#poolLastBlockFound').timeago('dispose');
      if (chartsInitialized) {
        chartsInitialized = false;
        clearInterval(intervalChartsUpdate);
      }
    },
    update: function () {
      if (lastStats) {
        $('#networkLastBlockFound').timeago('update', new Date(lastStats.lastblock.timestamp * 1000).toISOString());


        updateText('networkHashrate', getReadableHashRateString(lastStats.network.difficulty / lastStats.config.coinDifficultyTarget) + '/sec');
        updateText('networkDifficulty', formatNumber(lastStats.network.difficulty.toString(), ' '));
        updateText('blockchainHeight', formatNumber(lastStats.network.height.toString(), ' '));
        //updateText('lastHash', lastStats.lastblock.hash).setAttribute('href', getBlockchainUrl(lastStats.lastblock.hash));

        if (lastStats.config.networkFee) {
          var networkFeePercent = lastStats.config.networkFee / 100;
          updateText('networkLastReward', getReadableCoins(lastStats.lastblock.reward - (lastStats.lastblock.reward * networkFeePercent)));
        } else {
          updateText('networkLastReward', getReadableCoins(lastStats.lastblock.reward));
        }

        updateText('poolHashrate', getReadableHashRateString(lastStats.pool.hashrate, 0) + '/sec');
        updateText('blocksTotal', lastStats.pool.totalBlocks.toString());

        var hashPower = lastStats.pool.hashrate / (lastStats.network.difficulty / lastStats.config.coinDifficultyTarget) * 100;
        updateText('hashPower', hashPower.toFixed(2) + '%');

        if (lastStats.pool.lastBlockFound) {
          var d = new Date(parseInt(lastStats.pool.lastBlockFound)).toISOString();
          $('#poolLastBlockFound').timeago('update', d);
        } else {
          $('#poolLastBlockFound')
            .removeAttr('title')
            .data('ts', '')
            .update('Never');
        }

        updateText('poolMiners', lastStats.pool.miners.toString());
        updateText('poolWorkers', lastStats.pool.workers.toString());

        var totalFee = lastStats.config.fee;
        if (Object.keys(lastStats.config.donation).length) {
          var totalDonation = 0;
          for (var i in lastStats.config.donation) {
            totalDonation += lastStats
              .config
              .donation[i];
          }
          totalFee += totalDonation;
        }
        updateText('poolFee', (
          totalFee > 0 && totalFee != 100
            ? floatToString(totalFee)
            : (
              totalFee == 100
                ? '100'
                : '0')) + '%');

        updateText('paymentsInterval', getReadableTime(lastStats.config.paymentsInterval));
        updateText('paymentsMinimum', getReadableCoins(lastStats.config.minPaymentThreshold));

        updateText('blockSolvedTime', getReadableTime(lastStats.network.difficulty / lastStats.pool.hashrate));
        updateText('currentEffort', (lastStats.pool.roundHashes / lastStats.network.difficulty * 100).toFixed(1) + '%');

        if (lastStats.charts && !chartsInitialized) {
          intervalChartsUpdate = setInterval(createCharts, 60 * 1000);
          createCharts();
          chartsInitialized = true;
        }
      }
    }
  };

  // Enable timeago on last block found
  $('#networkLastBlockFound,#poolLastBlockFound').timeago();

  /**
   * Charts
   **/

  // Create charts
  function createCharts() {
    if (!lastStats || !lastStats.charts)
      return;
    var data = lastStats.charts;

    var graphData = {
      hashrate: getGraphData(data.hashrate),
      diff: getGraphData(data.difficulty),
      miners: getGraphData(data.miners),
      workers: getGraphData(data.workers)
    };

    if (poolHashrateChart) {
      poolHashrateChart.destroy();
    }

    poolHashrateChart = new Chart(document.getElementById('chartPoolHashrateCanvas'), {
      type: 'bar',
      data: {
        labels: graphData.hashrate.names,
        datasets: [
          {
            data: graphData.hashrate.values,
            backgroundColor: 'rgba(255,165,1,1)',
            fill: true,
            borderWidth: 0,
            borderColor: '#FFA500'
          }
        ]
      },
      options: {
        animation: false,
        responsive: true,
        maintainAspectRatio: false,
        legend: {
          display: false,
          labels: {
            display: false
          }
        },
        scales: {
          yAxes: [
            {
              ticks: {
              maxTicksLimit: 5,
              beginAtZero: true,
              fontSize: 10
            },
              gridLines: {
                
              }
            }
          ],
          xAxes: [
              {
              ticks: {
              beginAtZero: true,
              fontSize: 11
              },
              gridLines: {
                
              }
            }
          ]
        }
      }
    });

    if (diffChart) {
      diffChart.destroy();
    }

    diffChart = new Chart(document.getElementById('chartCurrDiffCanvas'), {
      type: 'bar',
      data: {
        labels: graphData.diff.names,
        datasets: [
          {
            data: graphData.diff.values,
            backgroundColor: 'rgba(255,165,1,1)',
            fill: true,
            borderWidth: 0,
            borderColor: '#FFA500'
          }
        ]
      },
      options: {
        animation: false,
        responsive: true,
        maintainAspectRatio: false,
        legend: {
          display: false,
          labels: {
            display: false
          }
        },
        scales: {
          yAxes: [
              {
              ticks: {
              maxTicksLimit: 5,
              beginAtZero: true,
              fontSize: 10
            },
              gridLines: {
                
              }
            },         
          ],
          xAxes: [
            {
              ticks: {
              beginAtZero: true,
              fontSize: 11
            },
              gridLines: {
                  
              }
            }
          ]
        }
      }
    });

    var blockValues = [];
    for (var propertyName in lastStats.charts.blocks) {
      blockValues.push(lastStats.charts.blocks[propertyName]);
    }

    // $("#chartMiners").html(graphData.miners.values.join());
    // $("#chartBlocksFound").html(blockValues.join());

    // new Chart(document.getElementById('chartMiners'), {
    //   type: 'bar',
    //   data: {
    //     labels: graphData.miners.values,
    //     datasets: [
    //       {
    //         data: graphData.miners.values,
    //         backgroundColor: 'rgba(255,165,1,1)',
    //         fill: true,
    //         borderWidth: 0,
    //         borderColor: '#FFA500'
    //       }
    //     ]
    //   },
    //   options: {
    //     animation: false,
    //     responsive: true,
    //     maintainAspectRatio: false,
    //     legend: {
    //       display: false,
    //       labels: {
    //         display: false
    //       }
    //     },
    //     scales: {
    //       yAxes: [
    //           {
    //             display: false
    //         //   ticks: {
    //         //   maxTicksLimit: 5,
    //         //   beginAtZero: false,
    //         //   fontSize: 10
    //         // },
    //         //   gridLines: {
                
    //         //   }
    //         },         
    //       ],
    //       xAxes: [
    //         {
    //           ticks: {
    //           beginAtZero: true,
    //           fontSize: 11
    //         },
    //           gridLines: {
                  
    //           }
    //         }
    //       ]
    //     }
    //   }
    // });

    // $('#chartMiners').sparkline('html', {
    //   width: '100%',
    //   height: '55',
    //   lineColor: '#FFA500',
    //   spotColor: '#FFFFFF',
    //   maxSpotColor: '#FFFFFF',
    //   minSpotColor: '#FFFFFF',
    //   fillColor: 'rgba(255,165,0,0.2)'
    // });

    // $('#chartBlocksFound').sparkline('html', {
    //   width: '100%',
    //   height: '55',
    //   lineColor: '#FFA500',
    //   spotColor: '#FFFFFF',
    //   maxSpotColor: '#FFFFFF',
    //   minSpotColor: '#FFFFFF',
    //   fillColor: 'rgba(255,165,0,0.2)'
    // });
  }

  // Get chart data
  function getGraphData(rawData) {
    var graphData = {
      names: [],
      values: []
    };
    if (rawData) {
      for (var i = 0, xy; xy = rawData[i]; i++) {
        graphData
          .names
          .push(new Date(xy[0] * 1000).toLocaleString());
        graphData
          .values
          .push(xy[1]);
      }
    }
    return graphData;
  }

  /**
   * Hash Profitability Calculator
   **/

  // Automatically update profit calculation on key press
  $('#calcHashRate')
    .keyup(calcEstimateProfit)
    .change(calcEstimateProfit);

  // Click on button
  $('#calcHashUnits > li > a').click(function (e) {
    e.preventDefault();
    $('#calcHashUnit')
      .text($(this).text())
      .data('mul', $(this).data('mul'));
    calcEstimateProfit();
  });

  $('#hashrateToggle').on('toggle', function (e, active) {
    calcEstimateProfit();
  });

  // Calculate current estimation
  function calcEstimateProfit() {
    try {
      var addHashrateToNetwork = $('#hashrateToggle')
        .data('toggles')
        .active;
      var rateUnit = Math.pow(1000, parseInt($('#calcHashUnit').data('mul')));
      var hashRate = parseFloat($('#calcHashRate').val()) * rateUnit;
      var networkHash = lastStats.network.difficulty / lastStats.config.coinDifficultyTarget;
      if (addHashrateToNetwork) {
        networkHash = networkHash + hashRate;
      }
      var profit = lastStats.lastblock.reward * (1440 / 2) * (hashRate / networkHash);
      if (profit) {
        updateText('calcHashAmount1', getReadableCoins(profit, 2));
        updateText('calcHashAmount2', getCurrencyPriceText(profit));
        return;
      }
    } catch (e) { }
    updateText('calcHashAmount1', '');
    updateText('calcHashAmount2', '');
  }

  // Get price in specified currency
  function getCurrencyPriceText(coinsRaw) {
    if (USDperXUNI) {
      var amount = parseFloat((parseInt(coinsRaw || 0) / lastStats.config.coinUnits).toFixed(2));
      var price = USDperXUNI * amount;
      return ("($ " + price.toFixed(2) + ")");
    }
  }


  $(document).ready(function () {
    getXUNIdata()

  })


  async function getXUNIdata() {
    //var currencies = ["USD", "EUR", "BTC", "LTC", "ETH"]
    var currencies = ["USD", "BTC"]
    for (var item of currencies) {
      var data = await getprice(item)
      if (data) {
        data = data[0]
        $(`#XUNITo${item}`).text(parseFloat(data.price).toFixed(8))
      }
    }
  }

  function getprice(item) {
    return new Promise(function (resolve, reject) {
      $.getJSON(`https://api.allorigins.win/get?url=${encodeURIComponent(`https://api.nomics.com/v1/currencies/ticker?key=507809c103093e0c58f74648d03644c2d0c0ade4&ids=XUNI&interval=1d,30d&convert=${item}&per-page=100&page=1`)}`, function (data, textStatus, jqXHR) {
        setTimeout(() => {
          resolve(JSON.parse(data.contents))
        }, 1500)
      })
    })
  }



</script>
